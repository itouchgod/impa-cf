# Cloudflare Pages éƒ¨ç½²é—®é¢˜ä¿®å¤æŒ‡å—

## ğŸš¨ é—®é¢˜è¯Šæ–­

æ ¹æ®éƒ¨ç½²æ—¥å¿—åˆ†æï¼Œå‘ç°äº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

### 1. æ— æ•ˆçš„é‡å®šå‘è§„åˆ™
```
- #10: /pdf-viewer/* /pdf-viewer/index.html 200
  Infinite loop detected in this rule and has been ignored.
- #32: /* /404.html 404
  Valid status codes are 200, 301, 302 (default), 303, 307, or 308. Got 404.
```

### 2. æ„å»ºé…ç½®é—®é¢˜
- Next.js é…ç½®ä¸­å­˜åœ¨æ— æ•ˆçš„ experimental é€‰é¡¹
- é™æ€å¯¼å‡ºé…ç½®éœ€è¦ä¼˜åŒ–

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: æ›´æ–° _redirects æ–‡ä»¶

**é—®é¢˜**: 
- `/pdf-viewer/*` è§„åˆ™å¯¼è‡´æ— é™å¾ªç¯
- `/* /404.html 404` ä½¿ç”¨äº†æ— æ•ˆçš„çŠ¶æ€ç 

**è§£å†³æ–¹æ¡ˆ**:
```diff
# å¤„ç† PDF æŸ¥çœ‹å™¨è·¯ç”±
- /pdf-viewer/* /pdf-viewer/index.html 200
+ /pdf-viewer /pdf-viewer/index.html 200

# 404 å¤„ç† - ä½¿ç”¨è‡ªå®šä¹‰ 404 é¡µé¢
- /* /404.html 404
+ /* /404.html 200
```

### ä¿®å¤ 2: ä¼˜åŒ– Next.js é…ç½®

**é—®é¢˜**: 
- `outputFileTracingRoot` ä¸æ˜¯æœ‰æ•ˆçš„ experimental é€‰é¡¹

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// ç§»é™¤æ— æ•ˆçš„é…ç½®é€‰é¡¹
experimental: {
  // é™æ€å¯¼å‡ºä¼˜åŒ–
},
```

### ä¿®å¤ 3: æ”¹è¿›æ„å»ºè„šæœ¬

**æ›´æ–°**: åœ¨æ„å»ºè„šæœ¬ä¸­æ·»åŠ æˆåŠŸæç¤º
```json
"build:cloudflare": "cp next.config.cloudflare.ts next.config.ts && next build && cp _headers _redirects out/ && echo 'Cloudflare build completed successfully'"
```

## ğŸš€ é‡æ–°éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: æœ¬åœ°æ„å»ºæµ‹è¯•
```bash
cd /Users/roger/website/0-done/impa-cf
npm run build:cloudflare
```

### æ­¥éª¤ 2: éªŒè¯æ„å»ºç»“æœ
ç¡®ä¿ `out/` ç›®å½•åŒ…å«ï¼š
- âœ… `index.html` - é¦–é¡µ
- âœ… `search/index.html` - æœç´¢é¡µé¢
- âœ… `_headers` - å¤´éƒ¨é…ç½®
- âœ… `_redirects` - é‡å®šå‘é…ç½®ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… `pdfs/` - PDF æ–‡ä»¶ç›®å½•
- âœ… `pdf-viewer/` - PDF æŸ¥çœ‹å™¨

### æ­¥éª¤ 3: ä¸Šä¼ åˆ° Cloudflare Pages

#### æ–¹æ³• A: æ‰‹åŠ¨ä¸Šä¼ ï¼ˆæ¨èï¼‰
1. è®¿é—® [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. è¿›å…¥ "Pages" éƒ¨åˆ†
3. é€‰æ‹©ä½ çš„é¡¹ç›®æˆ–åˆ›å»ºæ–°é¡¹ç›®
4. ç‚¹å‡» "Upload assets"
5. ä¸Šä¼  `out/` æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å†…å®¹
6. ç‚¹å‡» "Deploy site"

#### æ–¹æ³• B: Git é›†æˆ
1. æ¨é€ä¿®å¤åçš„ä»£ç åˆ° GitHub
2. Cloudflare ä¼šè‡ªåŠ¨é‡æ–°æ„å»ºå’Œéƒ¨ç½²

### æ­¥éª¤ 4: éªŒè¯éƒ¨ç½²
è®¿é—®ä½ çš„ Cloudflare Pages URLï¼Œæ£€æŸ¥ï¼š
- âœ… é¦–é¡µæ­£å¸¸åŠ è½½
- âœ… æœç´¢åŠŸèƒ½å·¥ä½œ
- âœ… PDF æ–‡ä»¶å¯ä»¥è®¿é—®
- âœ… æ²¡æœ‰ 404 é”™è¯¯

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### é‡å®šå‘è§„åˆ™è¯´æ˜

**ä¿®å¤å‰çš„é—®é¢˜**:
```bash
/pdf-viewer/* /pdf-viewer/index.html 200  # æ— é™å¾ªç¯
/* /404.html 404                          # æ— æ•ˆçŠ¶æ€ç 
```

**ä¿®å¤åçš„è§„åˆ™**:
```bash
/pdf-viewer /pdf-viewer/index.html 200    # ç²¾ç¡®åŒ¹é…
/* /404.html 200                          # æ­£ç¡®çš„çŠ¶æ€ç 
```

### æ„å»ºé…ç½®ä¼˜åŒ–

**å…³é”®é…ç½®**:
```typescript
const nextConfig: NextConfig = {
  output: 'export',           // é™æ€å¯¼å‡º
  trailingSlash: true,        // æ·»åŠ å°¾éƒ¨æ–œæ 
  skipTrailingSlashRedirect: true,
  distDir: 'out',            // è¾“å‡ºç›®å½•
  images: {
    unoptimized: true,       // ç¦ç”¨å›¾ç‰‡ä¼˜åŒ–
  },
  // ç§»é™¤æ— æ•ˆçš„ experimental é€‰é¡¹
};
```

## ğŸ“Š éƒ¨ç½²éªŒè¯æ¸…å•

- [ ] æ„å»ºæˆåŠŸå®Œæˆ
- [ ] `out/` ç›®å½•åŒ…å«æ‰€æœ‰å¿…è¦æ–‡ä»¶
- [ ] `_redirects` æ–‡ä»¶è¯­æ³•æ­£ç¡®
- [ ] `_headers` æ–‡ä»¶å­˜åœ¨
- [ ] PDF æ–‡ä»¶åœ¨ `out/pdfs/` ç›®å½•ä¸­
- [ ] é¦–é¡µ `index.html` å­˜åœ¨
- [ ] æœç´¢é¡µé¢ `search/index.html` å­˜åœ¨
- [ ] 404 é¡µé¢ `404.html` å­˜åœ¨

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œä½ çš„ Cloudflare Pages éƒ¨ç½²åº”è¯¥ï¼š
- âœ… æˆåŠŸéƒ¨ç½²ï¼Œæ— é”™è¯¯
- âœ… é¦–é¡µæ­£å¸¸è®¿é—®
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ²¡æœ‰é‡å®šå‘å¾ªç¯
- âœ… 404 é¡µé¢æ­£ç¡®æ˜¾ç¤º

## ğŸ“ æ•…éšœæ’é™¤

å¦‚æœä»ç„¶é‡åˆ°é—®é¢˜ï¼š

1. **æ£€æŸ¥æ„å»ºæ—¥å¿—**: ç¡®ä¿æœ¬åœ°æ„å»ºæˆåŠŸ
2. **éªŒè¯æ–‡ä»¶ç»“æ„**: ç¡®è®¤ `out/` ç›®å½•å®Œæ•´
3. **æ£€æŸ¥é‡å®šå‘è§„åˆ™**: ä½¿ç”¨ Cloudflare çš„è§„åˆ™éªŒè¯å™¨
4. **æ¸…é™¤ç¼“å­˜**: åœ¨ Cloudflare Dashboard ä¸­æ¸…é™¤ç¼“å­˜
5. **æ£€æŸ¥åŸŸåé…ç½®**: ç¡®è®¤è‡ªå®šä¹‰åŸŸåè®¾ç½®æ­£ç¡®

---

**æ³¨æ„**: è¿™äº›ä¿®å¤è§£å†³äº† Cloudflare Pages éƒ¨ç½²ä¸­çš„å…³é”®é…ç½®é—®é¢˜ã€‚é‡æ–°éƒ¨ç½²åï¼Œä½ çš„ç½‘ç«™åº”è¯¥èƒ½å¤Ÿæ­£å¸¸è®¿é—®å’Œè¿è¡Œã€‚
