# Cloudflare Pages éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ Cloudflare Dashboardï¼ˆæ¨èï¼‰

1. **å‡†å¤‡æ„å»ºæ–‡ä»¶**
   ```bash
   # æ„å»º Cloudflare ç‰ˆæœ¬
   npm run build:cloudflare
   ```

2. **ä¸Šä¼ åˆ° Cloudflare Pages**
   - è®¿é—® [Cloudflare Dashboard](https://dash.cloudflare.com/)
   - è¿›å…¥ "Pages" éƒ¨åˆ†
   - ç‚¹å‡» "Create a project"
   - é€‰æ‹© "Upload assets"
   - ä¸Šä¼  `out` æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å†…å®¹
   - è®¾ç½®é¡¹ç›®åç§°ï¼ˆå¦‚ï¼š`impa-pdf-search`ï¼‰
   - ç‚¹å‡» "Deploy site"

### æ–¹æ³•äºŒï¼šé€šè¿‡ Git é›†æˆ

1. **è¿æ¥ GitHub ä»“åº“**
   - åœ¨ Cloudflare Pages ä¸­é€‰æ‹© "Connect to Git"
   - æˆæƒå¹¶é€‰æ‹©ä½ çš„ GitHub ä»“åº“
   - è®¾ç½®æ„å»ºé…ç½®ï¼š
     - **Build command**: `npm run build:cloudflare`
     - **Build output directory**: `out`
     - **Root directory**: `/` (é¡¹ç›®æ ¹ç›®å½•)

2. **ç¯å¢ƒå˜é‡è®¾ç½®**
   ```
   NODE_VERSION=18
   NPM_VERSION=9
   ```

## ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

### æ„å»ºåçš„æ–‡ä»¶ç»“æ„
```
out/
â”œâ”€â”€ index.html              # é¦–é¡µ
â”œâ”€â”€ search.html             # æœç´¢é¡µé¢
â”œâ”€â”€ pdf-viewer/             # PDF æŸ¥çœ‹å™¨
â”œâ”€â”€ pdfs/                   # PDF æ–‡ä»¶
â”œâ”€â”€ icon-*.png              # PWA å›¾æ ‡
â”œâ”€â”€ brand-icon.svg          # å“ç‰Œå›¾æ ‡
â”œâ”€â”€ manifest.json           # PWA é…ç½®
â”œâ”€â”€ sw.js                   # Service Worker
â”œâ”€â”€ pdf.worker.min.js       # PDF.js Worker
â”œâ”€â”€ _next/                  # Next.js æ„å»ºæ–‡ä»¶
â””â”€â”€ _headers                # Cloudflare å¤´éƒ¨é…ç½®
```

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### 1. next.config.cloudflare.ts
- ä½¿ç”¨ `output: 'export'` è¿›è¡Œé™æ€å¯¼å‡º
- ç¦ç”¨æœåŠ¡å™¨ç«¯åŠŸèƒ½
- ä¼˜åŒ– PDF.js é…ç½®
- è®¾ç½®æ­£ç¡®çš„è¾“å‡ºç›®å½•

### 2. _headers
- é…ç½®ç¼“å­˜ç­–ç•¥
- è®¾ç½®å®‰å…¨å¤´
- ä¼˜åŒ– PDF æ–‡ä»¶è®¿é—®
- é…ç½® Service Worker

### 3. _redirects
- å¤„ç† Next.js è·¯ç”±
- é…ç½® PDF æ–‡ä»¶è®¿é—®
- å¤„ç† PWA èµ„æº

## ğŸ”§ éƒ¨ç½²æ­¥éª¤è¯¦è§£

### æ­¥éª¤ 1ï¼šæœ¬åœ°æ„å»º
```bash
# å®‰è£…ä¾èµ–
npm install

# æ„å»º Cloudflare ç‰ˆæœ¬
npm run build:cloudflare
```

### æ­¥éª¤ 2ï¼šéªŒè¯æ„å»ºç»“æœ
```bash
# æ£€æŸ¥æ„å»ºè¾“å‡º
ls -la out/

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å…³é”®æ–‡ä»¶ï¼š
# - index.html
# - search.html
# - pdf-viewer/
# - pdfs/
# - _headers
# - _redirects
```

### æ­¥éª¤ 3ï¼šä¸Šä¼ åˆ° Cloudflare
1. å‹ç¼© `out` æ–‡ä»¶å¤¹
2. åœ¨ Cloudflare Pages ä¸­ä¸Šä¼ 
3. ç­‰å¾…éƒ¨ç½²å®Œæˆ

### æ­¥éª¤ 4ï¼šé…ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰
1. åœ¨ Cloudflare Pages é¡¹ç›®è®¾ç½®ä¸­
2. æ·»åŠ è‡ªå®šä¹‰åŸŸå
3. é…ç½® DNS è®°å½•

## ğŸŒ éƒ¨ç½²åçš„è®¿é—®

### é»˜è®¤ URL
- éƒ¨ç½²å®Œæˆåä¼šè·å¾—ç±»ä¼¼ `https://your-project.pages.dev` çš„ URL

### åŠŸèƒ½éªŒè¯
1. **é¦–é¡µè®¿é—®**: `https://your-project.pages.dev/`
2. **æœç´¢åŠŸèƒ½**: `https://your-project.pages.dev/search?q=test`
3. **PDF æŸ¥çœ‹å™¨**: `https://your-project.pages.dev/pdf-viewer/`
4. **PWA å®‰è£…**: åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæµ‹è¯•å®‰è£…åŠŸèƒ½

## ğŸ“± PWA åŠŸèƒ½éªŒè¯

### iOS è®¾å¤‡
1. åœ¨ Safari ä¸­æ‰“å¼€ç½‘ç«™
2. ç‚¹å‡»åˆ†äº«æŒ‰é’®
3. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"
4. éªŒè¯å›¾æ ‡å’Œå…¨å±æ˜¾ç¤º

### Android è®¾å¤‡
1. åœ¨ Chrome ä¸­æ‰“å¼€ç½‘ç«™
2. ç‚¹å‡»å®‰è£…æç¤º
3. éªŒè¯åº”ç”¨å›¾æ ‡å’ŒåŠŸèƒ½

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1ï¼šéƒ¨ç½²åè¿”å› 404 é”™è¯¯
**åŸå› **: `_redirects` æ–‡ä»¶ä¸­çš„æ— æ•ˆé‡å®šå‘è§„åˆ™
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥å¹¶ä¿®å¤ _redirects æ–‡ä»¶
# ç¡®ä¿æ²¡æœ‰æ— é™å¾ªç¯è§„åˆ™
# ä½¿ç”¨æ­£ç¡®çš„çŠ¶æ€ç ï¼ˆ200, 301, 302 ç­‰ï¼‰
```

### é—®é¢˜ 2ï¼šPDF æ–‡ä»¶æ— æ³•åŠ è½½
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `_redirects` æ–‡ä»¶ä¸­çš„ PDF è·¯ç”±é…ç½®
- ç¡®ä¿ PDF æ–‡ä»¶åœ¨ `out/pdfs/` ç›®å½•ä¸­
- éªŒè¯ `_headers` ä¸­çš„ PDF ç¼“å­˜é…ç½®

### é—®é¢˜ 3ï¼šæœç´¢åŠŸèƒ½ä¸å·¥ä½œ
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `_redirects` ä¸­çš„æœç´¢è·¯ç”±é…ç½®
- ç¡®ä¿ `search.html` æ–‡ä»¶å­˜åœ¨
- éªŒè¯ JavaScript æ–‡ä»¶æ­£ç¡®åŠ è½½

### é—®é¢˜ 4ï¼šPWA åŠŸèƒ½å¼‚å¸¸
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `manifest.json` æ–‡ä»¶
- éªŒè¯ Service Worker é…ç½®
- ç¡®ä¿å›¾æ ‡æ–‡ä»¶å­˜åœ¨

### é—®é¢˜ 5ï¼šæ„å»ºå¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†ç¼“å­˜
rm -rf .next out node_modules
npm install
npm run build:cloudflare
```

### é—®é¢˜ 6ï¼šé‡å®šå‘å¾ªç¯é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `_redirects` æ–‡ä»¶ä¸­çš„é€šé…ç¬¦è§„åˆ™
- é¿å…ä½¿ç”¨ `/*` æ¨¡å¼å¯¼è‡´å¾ªç¯
- ä½¿ç”¨ç²¾ç¡®åŒ¹é…æˆ–æ­£ç¡®çš„é‡å®šå‘é€»è¾‘

**è¯¦ç»†ä¿®å¤æŒ‡å—**: è¯·å‚è€ƒ [CLOUDFLARE_DEPLOYMENT_FIX.md](./CLOUDFLARE_DEPLOYMENT_FIX.md)

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### è‡ªåŠ¨æ›´æ–°ï¼ˆGit é›†æˆï¼‰
- æ¨é€ä»£ç åˆ° GitHub
- Cloudflare è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²

### æ‰‹åŠ¨æ›´æ–°
```bash
# é‡æ–°æ„å»º
npm run build:cloudflare

# é‡æ–°ä¸Šä¼  out æ–‡ä»¶å¤¹
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### Cloudflare è‡ªåŠ¨ä¼˜åŒ–
- å…¨çƒ CDN åˆ†å‘
- è‡ªåŠ¨å‹ç¼©
- å›¾ç‰‡ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥

### é¡¹ç›®ç‰¹å®šä¼˜åŒ–
- PDF æ–‡ä»¶é•¿æœŸç¼“å­˜
- é™æ€èµ„æºç¼“å­˜
- Service Worker ç¼“å­˜ç­–ç•¥

## ğŸ”’ å®‰å…¨é…ç½®

### è‡ªåŠ¨å®‰å…¨å¤´
- X-Content-Type-Options
- X-Frame-Options
- X-XSS-Protection
- Referrer-Policy

### å†…å®¹å®‰å…¨ç­–ç•¥
å¯ä»¥åœ¨ Cloudflare Dashboard ä¸­é…ç½® CSP å¤´

## ğŸ“ˆ ç›‘æ§å’Œåˆ†æ

### Cloudflare Analytics
- è®¿é—®ç»Ÿè®¡
- æ€§èƒ½æŒ‡æ ‡
- é”™è¯¯ç›‘æ§

### è‡ªå®šä¹‰ç›‘æ§
- åœ¨ä»£ç ä¸­æ·»åŠ åˆ†æå·¥å…·
- ç›‘æ§ PDF åŠ è½½æ€§èƒ½
- è·Ÿè¸ªç”¨æˆ·æœç´¢è¡Œä¸º

## ğŸ¯ æœ€ä½³å®è·µ

1. **å®šæœŸæ›´æ–°ä¾èµ–**
2. **ç›‘æ§æ„å»ºå¤§å°**
3. **ä¼˜åŒ– PDF æ–‡ä»¶å¤§å°**
4. **æµ‹è¯•æ‰€æœ‰åŠŸèƒ½**
5. **é…ç½®é€‚å½“çš„ç¼“å­˜ç­–ç•¥**

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æ£€æŸ¥ Cloudflare Pages æ„å»ºæ—¥å¿—
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
3. éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
4. å‚è€ƒ Cloudflare Pages æ–‡æ¡£

---

**æ³¨æ„**: è¿™ä¸ªé¡¹ç›®å·²ç»é’ˆå¯¹ Cloudflare Pages è¿›è¡Œäº†ä¼˜åŒ–ï¼ŒåŒ…æ‹¬é™æ€å¯¼å‡ºã€ç¼“å­˜ç­–ç•¥ã€è·¯ç”±é…ç½®ç­‰ã€‚éƒ¨ç½²ååº”è¯¥èƒ½å¤Ÿå®Œç¾è¿è¡Œæ‰€æœ‰åŠŸèƒ½ã€‚
