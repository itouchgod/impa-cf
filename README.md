# IMPA Marine Stores Guide PDF搜索平台

这是一个基于Next.js构建的PDF搜索平台，专门用于搜索IMPA Marine Stores Guide第8版2023的内容。平台采用现代化的设计和技术，提供流畅的用户体验和高效的搜索功能。

## 🌟 核心功能

- 🔍 **智能搜索**
  - 即时搜索和结果预览
  - 跨章节全文搜索
  - 搜索结果高亮显示
  - 智能上下文展示
  - 搜索结果动态高度调整

- 📄 **高级PDF查看**
  - 内置PDF.js查看器
  - 精确页面导航
  - 智能缩放控制
  - 文本选择和复制
  - 页面宽高比自动适配

- 📱 **移动端优化**
  - PWA支持，可安装到主屏幕
  - 触摸友好的操作界面
  - 底部导航栏设计
  - 智能布局适配
  - 手势操作支持

- ⚡ **性能优化**
  - PDF智能分割（471MB → 9个章节）
  - 按需加载机制
  - 本地缓存系统
  - 资源预加载
  - 响应式图片加载

## 💫 界面特性

### 桌面端体验
- 现代化的Material Design风格
- 可拖动的悬浮按钮设计
- 流畅的动画过渡效果
- 键盘快捷键支持
- 智能布局比例（3:1或4:1）
- 悬浮按钮位置记忆功能

### 移动端体验
- 专用底部导航栏
- 大按钮易触设计
- 动态搜索结果面板
- 智能文本截断
- 沉浸式阅读体验

### 平板端优化
- 结合桌面端和移动端的优点
- 适中尺寸的控制按钮
- 灵活的布局切换
- 触摸和鼠标双重支持

## 🛠 技术栈

- **框架**: Next.js 14 (App Router)
- **UI**: React + TypeScript
- **样式**: Tailwind CSS
- **PDF处理**: PDF.js
- **图标**: Lucide React
- **缓存**: LocalStorage + 自定义缓存系统

## 📦 智能缓存系统

- **PDF文件缓存**: 1年有效期，PDF文件不会变化，最大化缓存效果
- **搜索结果缓存**: 7天有效期，平衡性能与新鲜度
- **静态资源缓存**: 1年有效期，减少服务器压力
- **版本控制机制**: 确保数据一致性和兼容性
- **用户可手动管理缓存**: 支持清理和重置
- **自动检测资源状态**: 实时加载状态显示
- **智能过期策略**: 不同资源类型采用不同缓存时间

## 📱 PWA功能

### iOS安装
1. 在Safari中打开
2. 点击分享按钮
3. 选择"添加到主屏幕"

### Android安装
1. 在Chrome中打开
2. 点击安装提示
3. 或通过菜单添加到主屏幕

### PWA特性
- 全屏显示模式
- 离线访问支持
- 自适应图标
- 原生应用体验

## 🎯 性能优化

### PDF文件优化
- 智能分割为9个功能章节
- 每章节控制在50MB以内
- 按需加载减少资源消耗
- 预加载提升访问速度

### 界面优化
- 精确的宽高比控制
- 设备适配的缩放策略
- 高DPI显示支持
- 容器自适应调整

## 🔄 最新更新

- 🏠 **首页路径优化（2024-12-19）**
  - 移除根路径到 `/home` 的重定向，首页内容直接显示在根路径 `/`
  - 更新所有导航链接，确保从搜索页面能正确返回首页
  - 简化URL结构，提升用户体验和SEO友好性
  - 删除不再需要的 `/home` 路由文件夹
- 🔧 **TypeScript类型错误修复（2024-12-19）**
  - 修复 ExtensionIsolator 组件中的 TypeScript 类型错误
  - 使用类型断言解决 window 对象扩展属性的类型问题
  - 添加 HTMLElement 类型检查确保样式操作的安全性
  - 确保生产环境构建成功通过
- 🛡️ **Chext扩展干扰完全解决（2024-12-19）**
  - 大幅增强扩展检测能力，识别 Chext 扩展的所有相关脚本和元素
  - 强化扩展隔离样式，完全隐藏扩展注入的元素和脚本
  - 增强 MutationObserver 错误处理，修复参数类型验证问题
  - 扩展错误抑制关键词列表，静默处理所有 Chext 相关错误和警告
  - 无论是否检测到扩展都启用保护机制，确保网站稳定运行
  - 解决 "Failed to execute 'observe' on 'MutationObserver'" 等关键错误
  - 增强早期错误抑制脚本，在页面加载前就过滤所有扩展相关错误
  - 添加更多错误关键词，包括 "Failed to execute 'appendChild' on 'Node'" 等
  - 完全静默处理扩展注入的 VM 脚本和 webpack 相关错误
  - 新增全局错误处理机制，捕获 window.onerror 和 window.onunhandledrejection
  - 添加 VM56:14 等新的扩展错误关键词，确保完全覆盖所有扩展干扰
  - 修复 TypeScript 类型错误，确保生产环境构建成功
- 🛡️ **浏览器扩展错误处理增强（2024-12-19）**
  - 新增 ExtensionIsolator 组件，专门检测和隔离浏览器扩展干扰
  - 增强 HydrationErrorSuppressor，支持更多扩展错误类型（Chext、YouTube扩展等）
  - 优化早期错误抑制脚本，在页面加载前就过滤扩展相关错误
  - 添加扩展注入元素监控，自动隐藏扩展注入的DOM元素
  - 创建扩展隔离样式，保护关键页面元素不被扩展修改
  - 支持检测常见扩展：Chext、YouTube扩展、Chrome扩展等
  - 静默处理扩展相关的控制台错误和警告，提升用户体验
  - 添加扩展检测日志，帮助开发者了解页面上的扩展情况
- 🎨 **加载界面重新设计（2024-12-19）**
  - 全新设计的LoadingScreen组件，提供更优雅的加载体验
  - IMPA logo作为进度条移动图标，增强品牌识别度
  - 渐变背景和发光效果，提升视觉体验
  - 响应式布局，适配各种设备尺寸
  - 平滑的动画过渡和进度指示
  - 实时显示当前加载章节和进度信息
  - 错误状态处理和用户友好的提示信息
  - 移除原有的底部进度条，采用全屏加载界面
- 🔧 **水合错误修复（2024-12-19）**
  - 修复 React 水合不匹配错误，确保服务器端和客户端渲染一致
  - 优化 ThemeContext，添加 mounted 状态检查，避免服务器端访问 localStorage
  - 修复 PDFTextContext 中的客户端检查逻辑，添加 mounted 状态管理
  - 改进 HomePage 组件的挂载检查，添加 suppressHydrationWarning 属性和 DOM 保护
  - 增强 HydrationErrorSuppressor 组件，更彻底地识别和抑制浏览器扩展导致的水合错误
  - 在 layout.tsx 中添加早期水合错误抑制脚本，使用 beforeInteractive 策略
  - 特别针对 YouTube 扩展（yt-ext-）和其他常见扩展的水合错误进行优化
  - 添加 DOM 隔离和 z-index 保护，防止浏览器扩展修改页面内容
  - 所有 Context 提供者现在都正确处理服务器端渲染和客户端水合
  - 使用多层错误抑制机制，确保水合错误的完全消除
  - **生产环境修复**：创建 NoSSR 组件，彻底避免服务器端渲染导致的水合错误
  - 为 HomePage 组件添加 NoSSR 包装，确保在客户端安全渲染
  - 解决生产环境中的 React 错误 #418（压缩后的水合错误）
- 🎯 **可拖动悬浮按钮**
  - 悬浮按钮可自由拖拽到页面任意位置
  - 位置自动保存到本地存储
  - 双击页码区域重置到默认位置
  - 智能边界检测防止拖出屏幕
  - 支持鼠标和触摸操作
- 🚀 **性能优化**
  - 智能性能监控，减少控制台日志噪音
  - 优化页码验证逻辑，静默处理边界情况
  - 改进搜索结果处理，避免无效页码警告
  - 缓存策略优化，提升加载速度
  - 开发者工具集成，支持动态性能监控控制
- 🌙 **完整黑夜模式支持**
  - 智能主题切换（浅色/深色/跟随系统）
  - 平滑的主题过渡动画
  - 所有组件完美适配黑夜模式
  - 主题偏好本地存储
- 🧹 **代码优化**
  - 清理冗余代码和未使用的属性
  - 优化组件接口，移除不必要的参数
  - 简化性能监控逻辑，提升执行效率
  - 优化缓存清理机制，批量处理过期项
  - 移除不必要的延迟和等待时间
- 优化悬浮按钮设计和交互
- 改进移动端导航体验
- 增强搜索结果展示
- 完善响应式布局
- 优化缓存管理机制

## 📋 使用说明

### 基本操作
1. 在搜索框输入关键词
2. 使用快捷键（Ctrl+Enter）搜索
3. 点击结果跳转对应页面
4. 使用导航按钮或键盘方向键翻页
5. 通过底部工具栏控制显示

### 高级功能
- 跨章节搜索
- 智能搜索建议
- 上下文预览
- 页面缩放控制
- 文本选择复制
- 主题切换（浅色/深色/跟随系统）
- 悬浮按钮拖拽定位

### 开发者工具（开发环境）
在浏览器控制台中输入以下命令：

```javascript
// 性能监控
devTools.performance.enableVerbose()  // 启用详细性能日志
devTools.performance.disableVerbose() // 禁用详细性能日志
devTools.performance.getMetrics()     // 查看所有性能指标
devTools.performance.getAverages()    // 查看平均性能

// 工具
devTools.clearConsole()               // 清空控制台
devTools.help()                       // 显示帮助信息
```

## 🔜 开发计划

- [ ] 服务器端搜索API
- [ ] 搜索历史功能
- [ ] 多PDF文件搜索
- [ ] 书签和注释功能
- [ ] 全文索引和高级搜索

## 📄 许可证

MIT License